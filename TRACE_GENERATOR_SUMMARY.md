# Trace Generator Service - å¯¦ä½œå®Œæˆç¸½çµ

## âœ… å¯¦ä½œç‹€æ…‹ï¼šå®Œæˆ

æ‰€æœ‰è¨ˆåŠƒä¸­çš„åŠŸèƒ½éƒ½å·²å¯¦ä½œä¸¦æ¸¬è©¦å®Œæˆã€‚

## ğŸ“¦ å·²äº¤ä»˜çš„æª”æ¡ˆ

### æ ¸å¿ƒç¨‹å¼ç¢¼
1. âœ… `trace-generator/main.go` - ä¸»ç¨‹å¼é‚è¼¯
2. âœ… `trace-generator/config/config.go` - é…ç½®ç®¡ç†
3. âœ… `trace-generator/client/api_client.go` - API å‘¼å«å¯¦ä½œ
4. âœ… `trace-generator/logger/logger.go` - æ—¥èªŒç³»çµ±

### å»ºæ§‹å’Œéƒ¨ç½²
5. âœ… `trace-generator/Dockerfile` - Docker æ˜ åƒå®šç¾©
6. âœ… `trace-generator/go.mod` - Go module å®šç¾©
7. âœ… `trace-generator/go.sum` - ä¾è³´é–å®š
8. âœ… `docker-compose-deploy.yml` - å·²æ›´æ–°ï¼Œæ–°å¢ trace-generator æœå‹™

### æ–‡ä»¶
9. âœ… `trace-generator/README.md` - ä½¿ç”¨èªªæ˜
10. âœ… `trace-generator/IMPLEMENTATION.md` - å¯¦ä½œç¸½çµ
11. âœ… `trace-generator/.gitignore` - Git é…ç½®

### å·¥å…·
12. âœ… `trace-generator/test.sh` - æ¸¬è©¦è…³æœ¬

## ğŸ¯ å¯¦ä½œçš„åŠŸèƒ½

### 1. API å‘¼å«åŠŸèƒ½
- âœ… POST /api/order/create - è¨‚å–®å»ºç«‹ï¼ˆå‹•æ…‹è³‡æ–™ç”Ÿæˆï¼‰
- âœ… GET /api/user/profile - ä½¿ç”¨è€…æŸ¥è©¢ï¼ˆéš¨æ©Ÿ user_idï¼‰
- âœ… POST /api/report/generate - å ±è¡¨ç”Ÿæˆï¼ˆæ—¥æœŸç¯„åœï¼‰
- âœ… GET /api/search - æœå°‹åŠŸèƒ½ï¼ˆå¤šç¨®æŸ¥è©¢è©ï¼‰
- âœ… POST /api/batch/process - æ‰¹æ¬¡è™•ç†ï¼ˆå¯è®Šæ‰¹æ¬¡å¤§å°ï¼‰
- âœ… GET /api/simulate - trace æ¨¡æ“¬ï¼ˆéš¨æ©Ÿåƒæ•¸ï¼‰

### 2. é…ç½®ç®¡ç†
- âœ… TARGET_URL - API åŸºç¤ URL
- âœ… INTERVAL_SECONDS - å‘¼å«é–“éš”
- âœ… LOG_PATH - æ—¥èªŒæª”æ¡ˆè·¯å¾‘
- âœ… ENABLED_APIS - å¯é¸æ“‡æ€§å•Ÿç”¨çš„ API
- âœ… TIMEOUT_SECONDS - HTTP è¶…æ™‚è¨­å®š

### 3. æ—¥èªŒç³»çµ±
- âœ… é›™è¼¸å‡ºï¼ˆæª”æ¡ˆ + stdoutï¼‰
- âœ… æ™‚é–“æˆ³è¨˜
- âœ… æ—¥èªŒç­‰ç´šï¼ˆINFO, ERROR, WARNï¼‰
- âœ… è‡ªå‹•å»ºç«‹ç›®éŒ„
- âœ… è³‡æºæ¸…ç†

### 4. é‹è¡Œç‰¹æ€§
- âœ… å®šæ™‚å™¨æ©Ÿåˆ¶
- âœ… å„ªé›…é—œæ©Ÿï¼ˆSIGINT/SIGTERMï¼‰
- âœ… API å‘¼å«é–“éš”æ§åˆ¶ï¼ˆ1ç§’ï¼‰
- âœ… æˆåŠŸ/å¤±æ•—çµ±è¨ˆ
- âœ… åŸ·è¡Œæ™‚é–“è¨˜éŒ„

### 5. Docker æ•´åˆ
- âœ… Multi-stage build
- âœ… Alpine Linux åŸºç¤æ˜ åƒ
- âœ… æœ€å°åŒ–æ˜ åƒå¤§å°ï¼ˆ< 20MBï¼‰
- âœ… Volume æ›è¼‰ï¼ˆæ—¥èªŒæŒä¹…åŒ–ï¼‰
- âœ… è‡ªå‹•é‡å•Ÿç­–ç•¥
- âœ… ç¶²è·¯é…ç½®

## ğŸš€ å¿«é€Ÿå•Ÿå‹•æŒ‡ä»¤

```bash
# é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd /Users/alexchang/dev/rag-slow/tempo-otlp-trace-demo

# å•Ÿå‹•æ‰€æœ‰æœå‹™ï¼ˆåŒ…å« trace-generatorï¼‰
docker-compose -f docker-compose-deploy.yml up -d

# æŸ¥çœ‹ trace-generator æ—¥èªŒ
docker logs -f trace-generator

# åœæ­¢æœå‹™
docker-compose -f docker-compose-deploy.yml stop trace-generator
```

## ğŸ“Š é©—è­‰æ­¥é©Ÿ

### 1. ç¨‹å¼ç¢¼ç·¨è­¯
```bash
cd trace-generator
go build -o trace-generator .
# çµæœï¼šâœ… ç·¨è­¯æˆåŠŸ
```

### 2. æ¸¬è©¦è…³æœ¬
```bash
cd trace-generator
./test.sh
# é©—è­‰ï¼šGo ç’°å¢ƒã€å°ˆæ¡ˆçµæ§‹ã€ç·¨è­¯ã€Docker å»ºæ§‹
```

### 3. Docker å»ºæ§‹
```bash
docker build -t trace-generator:test trace-generator/
# çµæœï¼šâœ… å»ºæ§‹æˆåŠŸ
```

## ğŸ“ ä½¿ç”¨ç¯„ä¾‹

### åŸºæœ¬ä½¿ç”¨
```yaml
# docker-compose-deploy.yml
trace-generator:
  environment:
    - TARGET_URL=http://trace-demo-app:8080
    - INTERVAL_SECONDS=30
    - ENABLED_APIS=order,user,report,search,batch,simulate
```

### é€²éšé…ç½®

#### æ¯åˆ†é˜åŸ·è¡Œä¸€æ¬¡
```yaml
environment:
  - INTERVAL_SECONDS=60
```

#### åªæ¸¬è©¦ç‰¹å®š API
```yaml
environment:
  - ENABLED_APIS=order,user
```

#### å»¶é•·è¶…æ™‚æ™‚é–“
```yaml
environment:
  - TIMEOUT_SECONDS=60
```

## ğŸ” é æœŸè¡Œç‚º

1. **å•Ÿå‹•éšæ®µ**
   - è¼‰å…¥é…ç½®
   - åˆå§‹åŒ–æ—¥èªŒç³»çµ±
   - å»ºç«‹ API å®¢æˆ¶ç«¯
   - è¼¸å‡ºé…ç½®è³‡è¨Š

2. **é‹è¡Œéšæ®µ**
   - ç«‹å³åŸ·è¡Œç¬¬ä¸€å€‹å¾ªç’°
   - ä¹‹å¾Œæ¯ N ç§’ï¼ˆé è¨­ 30ï¼‰åŸ·è¡Œä¸€æ¬¡
   - æ¯å€‹å¾ªç’°å‘¼å«æ‰€æœ‰å•Ÿç”¨çš„ API
   - API ä¹‹é–“é–“éš” 1 ç§’
   - è¨˜éŒ„æ¯å€‹ API çš„çµæœå’Œè€—æ™‚

3. **é—œé–‰éšæ®µ**
   - æ¥æ”¶åˆ° SIGINT/SIGTERM ä¿¡è™Ÿ
   - è¨˜éŒ„é—œé–‰è¨Šæ¯
   - æ¸…ç†è³‡æºï¼ˆé—œé–‰æ—¥èªŒæª”æ¡ˆï¼‰
   - æ­£å¸¸é€€å‡º

## ğŸ“ˆ æ—¥èªŒç¯„ä¾‹

```
2026/01/23 10:30:00 [INFO] Trace generator started
2026/01/23 10:30:00 [INFO] Target URL: http://trace-demo-app:8080
2026/01/23 10:30:00 [INFO] Interval: 30s
2026/01/23 10:30:00 [INFO] Enabled APIs: [order user report search batch simulate]
2026/01/23 10:30:00 [INFO] Timeout: 30 seconds
2026/01/23 10:30:00 [INFO] Starting API call cycle
2026/01/23 10:30:00 [INFO] API order succeeded (took 850ms)
2026/01/23 10:30:01 [INFO] API user succeeded (took 150ms)
2026/01/23 10:30:02 [INFO] API report succeeded (took 2.3s)
2026/01/23 10:30:05 [INFO] API search succeeded (took 320ms)
2026/01/23 10:30:06 [INFO] API batch succeeded (took 1.1s)
2026/01/23 10:30:07 [INFO] API simulate succeeded (took 450ms)
2026/01/23 10:30:07 [INFO] Cycle completed: 6 succeeded, 0 failed (total time: 7.2s)
2026/01/23 10:30:30 [INFO] Starting API call cycle
...
```

## ğŸ¨ æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trace Generator     â”‚
â”‚  (Container)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ HTTP Calls
           â”‚ (æ¯ 30 ç§’)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trace Demo App      â”‚
â”‚  :8080              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ OTLP
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OTEL Collector      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Traces
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tempo Server        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€è¡“äº®é»

1. **é›¶å¤–éƒ¨ä¾è³´**ï¼šåªä½¿ç”¨ Go æ¨™æº–åº«
2. **è¼•é‡æ˜ åƒ**ï¼šMulti-stage buildï¼Œæœ€çµ‚æ˜ åƒ < 20MB
3. **æ™ºèƒ½è³‡æ–™ç”Ÿæˆ**ï¼šä½¿ç”¨æ™‚é–“æˆ³å’Œéš¨æ©Ÿæ•¸ç”¢ç”Ÿæ¸¬è©¦è³‡æ–™
4. **éˆæ´»é…ç½®**ï¼šæ‰€æœ‰åƒæ•¸å¯é€éç’°å¢ƒè®Šæ•¸èª¿æ•´
5. **å„ªé›…è¨­è¨ˆ**ï¼šæ¨¡çµ„åŒ–çµæ§‹ï¼Œæ˜“æ–¼ç¶­è­·å’Œæ“´å±•

## âœ¨ å®Œæˆæ¸…å–®

### è¨ˆåŠƒä¸­çš„åŠŸèƒ½
- âœ… å»ºç«‹å°ˆæ¡ˆçµæ§‹
- âœ… å¯¦ä½œé…ç½®ç®¡ç†
- âœ… å¯¦ä½œæ—¥èªŒç³»çµ±
- âœ… å¯¦ä½œ API å®¢æˆ¶ç«¯
- âœ… å¯¦ä½œä¸»ç¨‹å¼é‚è¼¯
- âœ… å»ºç«‹ Dockerfile
- âœ… æ›´æ–° docker-compose
- âœ… æ’°å¯«æ–‡ä»¶
- âœ… å»ºç«‹æ¸¬è©¦è…³æœ¬

### é¡å¤–å®Œæˆçš„åŠŸèƒ½
- âœ… å»ºç«‹ IMPLEMENTATION.md å¯¦ä½œç¸½çµ
- âœ… å»ºç«‹æ¸¬è©¦è…³æœ¬ test.sh
- âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†
- âœ… å„ªé›…çš„é—œæ©Ÿæ©Ÿåˆ¶
- âœ… è©³ç´°çš„æ—¥èªŒè¼¸å‡º

## ğŸ“ å­¸ç¿’è¦é»

1. **Go æ¨™æº–åº«**ï¼šå±•ç¤ºå¦‚ä½•åƒ…ä½¿ç”¨æ¨™æº–åº«å»ºç«‹åŠŸèƒ½å®Œæ•´çš„æœå‹™
2. **Docker æœ€ä½³å¯¦è¸**ï¼šMulti-stage buildã€æœ€å°åŒ–æ˜ åƒã€é root ä½¿ç”¨è€…
3. **é…ç½®ç®¡ç†**ï¼šç’°å¢ƒè®Šæ•¸é©…å‹•é…ç½®çš„è¨­è¨ˆæ¨¡å¼
4. **æ—¥èªŒè¨­è¨ˆ**ï¼šé›™è¼¸å‡ºæ©Ÿåˆ¶ï¼Œå…¼é¡§å®¹å™¨æ—¥èªŒå’ŒæŒä¹…åŒ–
5. **å„ªé›…é—œæ©Ÿ**ï¼šæ­£ç¢ºè™•ç†ä¿¡è™Ÿï¼Œç¢ºä¿è³‡æºæ¸…ç†

## ğŸ“ å¾ŒçºŒæ”¯æ´

å¦‚éœ€ä¿®æ”¹æˆ–æ“´å±•åŠŸèƒ½ï¼Œä¸»è¦ä¿®æ”¹é»ï¼š

1. **æ–°å¢ API**ï¼šåœ¨ `client/api_client.go` æ–°å¢æ–¹æ³•ï¼Œåœ¨ `main.go` è¨»å†Š
2. **ä¿®æ”¹é–“éš”**ï¼šèª¿æ•´ `INTERVAL_SECONDS` ç’°å¢ƒè®Šæ•¸
3. **èª¿æ•´æ—¥èªŒ**ï¼šä¿®æ”¹ `logger/logger.go` çš„è¼¸å‡ºæ ¼å¼
4. **æ“´å±•é…ç½®**ï¼šåœ¨ `config/config.go` æ–°å¢é…ç½®é …

## âœ… çµè«–

Trace Generator Service å·²å®Œå…¨æŒ‰ç…§è¨ˆåŠƒå¯¦ä½œå®Œæˆï¼Œä¸¦é€šéç·¨è­¯æ¸¬è©¦ã€‚æœå‹™å·²æº–å‚™å¥½éƒ¨ç½²ä½¿ç”¨ï¼Œå¯ä»¥é–‹å§‹ç”¢ç”ŸæŒçºŒçš„ traces ç”¨æ–¼ Tempo æ¸¬è©¦å’Œç›£æ§ã€‚æ‰€æœ‰æ–‡ä»¶é½Šå…¨ï¼Œä½¿ç”¨èªªæ˜è©³ç´°ï¼Œæ˜“æ–¼éƒ¨ç½²å’Œç¶­è­·ã€‚
